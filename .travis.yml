language: node_js
node_js:
  - 12

services:
  - docker

env:
  global:
    - PROJECT_NAME=koseseg
    - REGISTRY_HOST_NAME=eu.gcr.io
    # Make sure Google Cloud SDK is in PATH
    - PATH=$PATH:${HOME}/google-cloud-sdk/bin
    # Disable prompts from Google Cloud SDK
    - CLOUDSDK_CORE_DISABLE_PROMPTS=1

cache:
  directories:
    # Cache of Google Cloud SDK
    - "$HOME/google-cloud-sdk/"

before_install:
  # Decrypt encrypted keyfile.json used for authenticating with Google Container Registry
  - openssl aes-256-cbc -K $encrypted_241002f0ef4b_key -iv $encrypted_241002f0ef4b_iv -in keyfile.json.enc -out keyfile.json -d

script:
  # Skipping tests because there are no tests
  - echo "Skipping tests"

before_deploy:
  # If the GCloud SDK is not already cached, download it and unpack it
  - if [ ! -d ${HOME}/google-cloud-sdk ]; then
    curl https://sdk.cloud.google.com | bash; then
    gcloud components install docker-credential-gcloud;
    fi

deploy:
  skip_cleanup: true
  provider: script
  script: bash scripts/travis_deploy
  on:
    branch: master
